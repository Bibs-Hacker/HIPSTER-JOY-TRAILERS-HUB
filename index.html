<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MERA-B Movie Hub â€” Search Â· Trailer Â· Play</title>
<style>
  :root{
    --bg:#ff3fff; --card:#0f1720; --accent:#8b5cf6; --muted:#094ffe;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{margin:0;background:
    radial-gradient(800px 400px at 10% 10%, rgba(139,92,246,0.06), transparent 10%),
    radial-gradient(600px 300px at 90% 90%, rgba(14,165,233,0.04), transparent 10%),
    var(--bg);
    color:#e6eef8; -webkit-font-smoothing:antialiased}
  header{display:flex;gap:12px;align-items:center;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.03);backdrop-filter: blur(6px)}
  .logo{display:flex;align-items:center;gap:12px}
  .logo .dot{width:110px;height:45px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#0ffeff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#021028;animation:bounce 3s;box-shadow:0 8px 30px rgba(139,92,246,0.12)}
  h1{margin:0;font-size:18px}
  .searchbar{margin-left:auto;display:flex;gap:8px;align-items:center}
  input[type="search"]{background:var(--glass);border:4px solid rgba(255,255,255,1.04);padding:10px 12px;border-radius:10px;color:inherit;min-width:240px}
  button{background:transparent;border:4px solid rgba(25,255,255,1.06);padding:9px 12px;border-radius:10px;color:inherit;cursor:pointer}
  main{padding:18px;display:grid;grid-template-columns:1fr 340px;gap:18px}
  .results{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:16px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;overflow:hidden;box-shadow:0 6px 26px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02)}
  .poster{width:100%;height:225px;background:#071029;background-size:cover;background-position:center}
  .meta{padding:10px}
  .meta h3{margin:0;font-size:14px;line-height:1.2}
  .meta p{margin:6px 0 0;font-size:12px;color:var(--muted)}
  .sidebar{position:sticky;top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
  .notice{font-size:12px;color:var(--muted);padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:10px}
  .controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
  .load-more{display:block;margin:12px auto;padding:10px 16px;border-radius:10px}
  /* detail modal */
  .detail{position:fixed;inset:0;background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.9));display:none;align-items:center;justify-content:center;padding:24px;z-index:60}
  .detail.open{display:flex}
  .detail-card{width:min(1100px,96vw);max-height:92vh;background:linear-gradient(180deg,#081123, #07101a);border-radius:14px;padding:18px;display:grid;grid-template-columns:360px 1fr;gap:16px;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
  .detail .poster{height:520px;border-radius:10px}
  .detail h2{margin:0 0 6px}
  .genres{font-size:13px;color:var(--muted);margin-bottom:8px}
  .overview{font-size:14px;line-height:1.5;color:#d6e7ff}
  .providers{margin-top:10px}
  .providers img{height:34px;margin-right:8px;vertical-align:middle}
  .video-wrap{margin-top:12px}
  .video-wrap iframe, .video-wrap video{width:100%;height:360px;border-radius:10px;border:0;background:#000}
  .source-input{display:flex;gap:8px;align-items:center;margin-top:10px}
  .small{font-size:13px;color:var(--muted)}
  footer{padding:12px;text-align:center;color:var(--muted);font-size:20px;position:relative}
  @media(max-width:900px){main{grid-template-columns:1fr} .detail-card{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <div class="logo">
    <div class="dot">ðŸ’–M-BðŸ’ž</div>
    <div>
      <h1>JOY-HIPSTER TRAILER MOVIES HUBðŸŽ¬</h1>
      <marquee><strong><b>ENJOY YOUR BEST MOVIE TRAILES, SEARCH FOR POPULAR MOVIES AND ENJOY MY FUNS...</b></strong></marquee>
    </div>
  </div>

  <div class="searchbar" role="search">
    <input id="q" type="search" placeholder="Search movies (eg. Inception)" />
    <button id="searchBtn">Search</button>
    <button id="popularBtn" title="Show popular movies">Popular</button>
  </div>
</header>

<main>
  <section>
    <div class="notice">
      <strong>Usage:</strong> This app searches TMDB for metadata and plays trailers. To stream  a movie. Do not use this interface to access copyrighted content illegally.
    </div>

    <div id="results" class="results" aria-live="polite"></div>

    <button id="loadMore" class="load-more">Load more</button>
  </section>

  <aside class="sidebar">
    <div class="small">API Key: <code id="apikeyLabel"></code></div>
    <div style="height:10px"></div>
    <div>
      <label class="small">Theme</label>
      <div class="controls">
        <button id="themeDefault">Default</button>
        <button id="themePink">Pink</button>
      </div>
    </div>

    <div style="height:12px"></div>
  </aside>
</main>

<!-- detail modal -->
<div id="detail" class="detail" role="dialog" aria-hidden="true">
  <div class="detail-card" role="document">
    <div>
      <div id="detPoster" class="poster"></div>
      <div style="margin-top:10px">
        <div class="small">Add custom source (direct mp4 url) â€” for personal or licensed files only</div>
        <div class="source-input">
          <input id="customUrl" placeholder="https://yourserver.com/file.mp4" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
          <button id="addSourceBtn">Add</button>
        </div>
        <div style="height:8px"></div>
        <div id="currentSource" class="small">No custom source</div>
      </div>
    </div>

    <div>
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div>
          <h2 id="detTitle"></h2>
          <div class="genres" id="detMeta"></div>
        </div>
        <div style="display:flex;gap:8px">
          <button id="closeDetail">Close</button>
        </div>
      </div>

      <div class="overview" id="detOverview"></div>

      <div class="providers" id="detProviders"></div>

      <div class="video-wrap" id="videoWrap">
        <!-- trailer iframe or <video> will be injected -->
      </div>

      <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
        <button id="playSource">Play custom source</button>
        <a id="downloadBtn" style="display:inline-block;text-decoration:none;" download><button id="downloadAction">Download source</button></a>
        <button id="openYT">Open Trailer on YouTube</button>
      </div>

    </div>
  </div>
</div>

<footer>
  <marquee><strong><b>@BRIAN Vs MERAB SYSTEM | 2025/26</b></strong></strong></marquee><br>Â¶Built with TMDB metadata â€¢ Trailers via YouTube â€¢ For legal/educational/demo use only.
</footer>

<script>
/* ========== CONFIG (you already provided) ========== */
const apikey = "e950e51d5d49e85f7c2f17f01eb23ba3";
const apiEndpoint = "https://api.themoviedb.org/3";
const imgPath = "https://image.tmdb.org/t/p/original";

/* UI refs */
const q = document.getElementById('q');
const searchBtn = document.getElementById('searchBtn');
const popularBtn = document.getElementById('popularBtn');
const results = document.getElementById('results');
const loadMore = document.getElementById('loadMore');
const apiLabel = document.getElementById('apikeyLabel');
apiLabel.textContent = apikey.slice(0,6) + 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' + apikey.slice(-4);

/* detail refs */
const detail = document.getElementById('detail');
const detPoster = document.getElementById('detPoster');
const detTitle = document.getElementById('detTitle');
const detMeta = document.getElementById('detMeta');
const detOverview = document.getElementById('detOverview');
const detProviders = document.getElementById('detProviders');
const videoWrap = document.getElementById('videoWrap');
const closeDetail = document.getElementById('closeDetail');
const customUrlInput = document.getElementById('customUrl');
const addSourceBtn = document.getElementById('addSourceBtn');
const currentSource = document.getElementById('currentSource');
const playSource = document.getElementById('playSource');
const downloadBtn = document.getElementById('downloadBtn');
const downloadAction = document.getElementById('downloadAction');
const openYT = document.getElementById('openYT');

/* state */
let page = 1;
let lastQuery = '';
let lastResults = [];
let selectedMovie = null;
let customSourceUrl = ''; // per-session custom source (user-provided)

/* helpers */
function safeFetch(url){
  return fetch(url).then(r => {
    if(!r.ok) throw new Error('HTTP ' + r.status);
    return r.json();
  });
}

function makeCard(movie){
  const el = document.createElement('div');
  el.className = 'card';
  const poster = movie.poster_path ? imgPath + movie.poster_path : '';
  el.innerHTML = `
    <div class="poster" style="background-image:url('${poster.replace("'", "")}');"></div>
    <div class="meta">
      <h3>${escapeHtml(movie.title || movie.name || 'Untitled')}</h3>
      <p>${movie.release_date ? movie.release_date.slice(0,4) : ''} â€¢ ${truncate(movie.overview || '', 90)}</p>
    </div>
  `;
  el.addEventListener('click', ()=> openDetail(movie.id));
  return el;
}

function truncate(s,n){ return s && s.length>n ? s.slice(0,n-1)+'â€¦' : (s||'')}
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]) }

/* Search & populate */
async function search(query, reset=true){
  if(reset){ page = 1; results.innerHTML=''; lastResults=[] }
  lastQuery = query;
  const url = new URL(apiEndpoint + '/search/movie');
  url.search = new URLSearchParams({api_key:apikey,query,language:'en-US',page});
  try{
    const data = await safeFetch(url);
    data.results.forEach(m=>{
      lastResults.push(m);
      results.appendChild(makeCard(m));
    });
    if(data.page < data.total_pages) loadMore.style.display='block'; else loadMore.style.display='none';
  }catch(err){
    alert('Search error: ' + err.message);
  }
}

async function popular(reset=true){
  if(reset){ page=1; results.innerHTML=''; lastResults=[] }
  const url = new URL(apiEndpoint + '/movie/popular');
  url.search = new URLSearchParams({api_key:apikey,language:'en-US',page});
  try{
    const data = await safeFetch(url);
    data.results.forEach(m=>{
      lastResults.push(m);
      results.appendChild(makeCard(m));
    });
    if(data.page < data.total_pages) loadMore.style.display='block'; else loadMore.style.display='none';
  }catch(err){
    alert('Popular fetch error: ' + err.message);
  }
}

loadMore.addEventListener('click', ()=>{
  page++;
  if(lastQuery) search(lastQuery, false);
  else popular(false);
});

/* events */
searchBtn.addEventListener('click', ()=> {
  const val = q.value.trim();
  if(!val) { alert('Type something to search'); return }
  search(val);
});
q.addEventListener('keydown', (e)=> { if(e.key==='Enter'){ searchBtn.click() }});
popularBtn.addEventListener('click', ()=> popular());

/* detail modal open */
async function openDetail(movieId){
  selectedMovie = null;
  videoWrap.innerHTML = '<div class="small">Loading detailsâ€¦</div>';
  detail.setAttribute('aria-hidden','false'); detail.classList.add('open');
  try{
    const movie = await safeFetch(`${apiEndpoint}/movie/${movieId}?api_key=${apikey}&language=en-US`);
    selectedMovie = movie;
    detPoster.style.backgroundImage = movie.poster_path ? `url(${imgPath + movie.poster_path})` : '';
    detTitle.textContent = movie.title + (movie.release_date ? ` (${movie.release_date.slice(0,4)})` : '');
    detMeta.textContent = (movie.runtime ? movie.runtime+'m â€¢ ' : '') + (movie.genres ? movie.genres.map(g=>g.name).join(', ') : '');
    detOverview.textContent = movie.overview || 'No overview available.';
    // watch/providers
    detProviders.innerHTML = '<div class="small">Providers:</div>';
    try{
      const providers = await safeFetch(`${apiEndpoint}/movie/${movieId}/watch/providers?api_key=${apikey}`);
      const country = 'US'; // we show US by default; you may adapt
      const list = (providers.results && providers.results[country]) || providers.results['US'] || null;
      if(list && (list.flatrate || list.rent || list.buy)){
        const wrap = document.createElement('div');
        ['flatrate','rent','buy'].forEach(k=>{
          if(list[k]){
            const group = document.createElement('div');
            group.innerHTML = '<strong class="small">'+k+':</strong> ';
            list[k].forEach(p=>{
              const img = document.createElement('img');
              img.src = p.logo_path ? 'https://image.tmdb.org/t/p/original'+p.logo_path : '';
              img.alt = p.provider_name;
              img.title = p.provider_name;
              group.appendChild(img);
            });
            wrap.appendChild(group);
          }
        });
        detProviders.appendChild(wrap);
      } else detProviders.innerHTML += '<div class="small">No provider data for selected region.</div>';
    }catch(e){ detProviders.innerHTML += '<div class="small">Providers unavailable.</div>' }
    // trailer
    try{
      const videos = await safeFetch(`${apiEndpoint}/movie/${movieId}/videos?api_key=${apikey}&language=en-US`);
      const yt = videos.results.find(v=>v.site==='YouTube' && v.type.toLowerCase().includes('trailer'));
      if(yt){
        const iframe = document.createElement('iframe');
        iframe.src = `https://www.youtube.com/embed/${yt.key}?rel=0`;
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
        iframe.loading = 'lazy';
        videoWrap.innerHTML = '';
        videoWrap.appendChild(iframe);
        openYT.onclick = ()=> window.open(`https://www.youtube.com/watch?v=${yt.key}`,'_blank');
      } else {
        videoWrap.innerHTML = '<div class="small">No trailer found. You can add a custom source below.</div>';
        openYT.onclick = ()=> alert('Trailer not found.');
      }
    }catch(e){ videoWrap.innerHTML = '<div class="small">Videos unavailable.</div>'; openYT.onclick=()=>{} }
    // reset custom source text for this movie
    customSourceUrl = '';
    customUrlInput.value = '';
    currentSource.textContent = 'No custom source';
    downloadBtn.style.display = 'none';
  }catch(err){
    alert('Detail fetch error: ' + err.message);
    closeDetail.click();
  }
}

/* close detail */
closeDetail.addEventListener('click', ()=> {
  detail.classList.remove('open');
  detail.setAttribute('aria-hidden','true');
  videoWrap.innerHTML = '';
});

/* add custom source (user-provided direct mp4 url) */
addSourceBtn.addEventListener('click', ()=>{
  const val = customUrlInput.value.trim();
  if(!val){ alert('Paste a direct mp4 or webm URL'); return }
  // tiny validation
  if(!val.match(/^https?:\/\/.+\.(mp4|webm|ogg)(\?.*)?$/i)){
    if(!confirm('URL does not look like an mp4/webm. Keep anyway?')) return;
  }
  customSourceUrl = val;
  currentSource.textContent = 'Custom source: ' + customSourceUrl;
  downloadBtn.style.display = 'inline-block';
  downloadBtn.href = customSourceUrl;
  downloadBtn.setAttribute('download','movie-file');
  // auto play the source
  playCustomSource();
});

/* play custom source in the videoWrap */
function playCustomSource(){
  if(!customSourceUrl){ alert('No custom source set'); return }
  videoWrap.innerHTML = '';
  const vid = document.createElement('video');
  vid.controls = true;
  vid.playsInline = true;
  vid.src = customSourceUrl;
  vid.autoplay = true;
  vid.style.maxHeight = '60vh';
  videoWrap.appendChild(vid);
}

/* play button */
playSource.addEventListener('click', ()=> {
  playCustomSource();
});

/* download action: anchor already set; note browsers/CORS may restrict cross-origin downloads */
downloadAction.addEventListener('click', (e)=>{
  if(!customSourceUrl){ e.preventDefault(); alert('No custom source to download. Add a legal file URL first.'); return; }
  // Allow default anchor behavior; if CORS blocks, user may need server with CORS or to host file with correct headers.
});

/* small extras: theme toggles */
document.getElementById('themeDefault').addEventListener('click', ()=> {
  document.documentElement.style.setProperty('--accent','#8b5cf6');
});
document.getElementById('themePink').addEventListener('click', ()=> {
  document.documentElement.style.setProperty('--accent','#fb7185');
});

/* initial load: popular */
popular();

/* Utility: click outside detail to close */
detail.addEventListener('click', (ev)=>{
  if(ev.target === detail) closeDetail.click();
});

</script>
</body>
</html>
